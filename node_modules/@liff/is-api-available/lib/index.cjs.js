"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("tslib"),r=require("@liff/consts"),i=require("@liff/use"),n=require("@liff/util"),a=require("@liff/is-sub-window"),o=require("@liff/store"),t=require("@liff/get-line-version"),l=require("@liff/is-in-client"),s=require("@liff/is-logged-in"),c=require("@liff/get-os");function u(e){var r,i=o.getContext();return null===(r=null==i?void 0:i.availability)||void 0===r?void 0:r[e]}function d(e,i,a){var o=u(e),s=a||e;if(!o)return{available:!1,error:{code:r.FORBIDDEN,message:"".concat(s," is not allowed in this LIFF app")}};var c=o.minVer,d=o.unsupportedFromVer,f=!c||function(e,r){var i=t.getLineVersion();return!!i&&!(r&&n.compareVersion(i,r)>0)&&n.compareVersion(i,e)>=0}(c,d),p=l.isInClient();return p&&!f?{available:!1,error:{code:r.FORBIDDEN,message:"".concat(s," is unavailable in this client version.")}}:o.permission?p&&f||i?{available:!0}:{available:!1,error:{code:r.FORBIDDEN,message:"".concat(s," is not allowed in external browser")}}:{available:!1,error:{code:r.FORBIDDEN,message:"".concat(s," is not allowed in this LIFF app")}}}var f=function(){return s.isLoggedIn()?!n.isLIFFBrowser()&&n.isLINEBrowser()?{available:!1,error:{code:r.FORBIDDEN,message:"Subwindow is not supported in this browser"}}:a.isSubWindow()?{available:!1,error:{code:r.FORBIDDEN,message:"this api can be only called in parent window"}}:d("subwindowOpen",!0):{available:!1,error:{code:r.UNAUTHORIZED,message:"Need access_token for api call, Please login first"}}},p=["subwindowOpen","shareTargetPicker","multipleLiffTransition","scanCode","scanCodeV2","getAdvertisingId","addToHomeScreen","bluetoothLeFunction","skipChannelVerificationScreen","createShortcutOnHomeScreen","internalCreateShortcutOnHomeScreen"],b={scanCode:function(){return d("scanCode")},getAdvertisingId:function(){return d("getAdvertisingId")},bluetoothLeFunction:function(){return d("bluetoothLeFunction")},shareTargetPicker:function(){return a.isSubWindow()?{available:!1,error:{code:r.FORBIDDEN,message:"this api can be only called in parent window"}}:s.isLoggedIn()?d("shareTargetPicker",!0):{available:!1,error:{code:r.UNAUTHORIZED,message:"Need access_token for api call, Please login first"}}},multipleLiffTransition:function(){var e=u("multipleLiffTransition");return e&&e.permission?l.isInClient()?{available:!0}:{available:!1,error:{code:r.FORBIDDEN,message:"multipleLiffTransition is available only in the LINE App browser"}}:{available:!1,error:{code:r.FORBIDDEN,message:"multipleLiffTransition is not allowed in this LIFF app"}}},subwindowOpen:f,scanCodeV2:function(){if(!s.isLoggedIn())return{available:!1,error:{code:r.UNAUTHORIZED,message:"Need access_token for api call, Please login first"}};var e=f();return e.available?d("scanCodeV2",!0):e},addToHomeScreen:function(){return a.isSubWindow()?{available:!1,error:{code:r.FORBIDDEN,message:"this api can be only called in parent window"}}:d("addToHomeScreen")},skipChannelVerificationScreen:function(){var e=o.getContext();return e?"square_chat"===e.type?{available:!1,error:{code:r.FORBIDDEN,message:"skipChannelVerificationScreen is not allowed in OpenChat"}}:d("skipChannelVerificationScreen"):{available:!1,error:{code:r.FORBIDDEN,message:"Context is not found"}}},createShortcutOnHomeScreen:function(){if(a.isSubWindow())return{available:!1,error:{code:r.FORBIDDEN,message:"this api can be only called in parent window"}};if(!s.isLoggedIn())return{available:!1,error:{code:r.UNAUTHORIZED,message:"Need access_token for api call, Please login first"}};var e=c.getOS();return"android"!==e&&"ios"!==e?{available:!1,error:{code:r.FORBIDDEN,message:"this api can be only called in mobile device"}}:d("addToHomeV2",!0,"createShortcutOnHomeScreen")},internalCreateShortcutOnHomeScreen:function(){if(a.isSubWindow())return{available:!1,error:{code:r.FORBIDDEN,message:"this api can be only called in parent window"}};if(!s.isLoggedIn())return{available:!1,error:{code:r.UNAUTHORIZED,message:"Need access_token for api call, Please login first"}};var e=c.getOS();if("android"!==e&&"ios"!==e)return{available:!1,error:{code:r.FORBIDDEN,message:"this api can be only called in mobile device"}};var i=d("addToHomeV2",!0,"internalCreateShortcutOnHomeScreen");return i.available?d("addToHomeLineScheme",!0,"internalCreateShortcutOnHomeScreen"):i}},g=function(e){return function(){var r=e();if(!r.available)throw n.createLiffError(r.error.code,r.error.message)}},v={scanCode:g(b.scanCode),getAdvertisingId:g(b.getAdvertisingId),bluetoothLeFunction:g(b.bluetoothLeFunction),shareTargetPicker:g(b.shareTargetPicker),multipleLiffTransition:g(b.multipleLiffTransition),subwindowOpen:g(b.subwindowOpen),scanCodeV2:g(b.scanCodeV2),addToHomeScreen:g(b.addToHomeScreen),skipChannelVerificationScreen:g(b.skipChannelVerificationScreen),createShortcutOnHomeScreen:g(b.createShortcutOnHomeScreen),internalCreateShortcutOnHomeScreen:g(b.internalCreateShortcutOnHomeScreen)};function m(e){if(!function(e){return p.some((function(r){return r===e}))}(e))throw n.createLiffError(r.INVALID_ARGUMENT,"Unexpected API name.");var i=b[e];return!i||i().available}var h=function(r){function i(){var e=null!==r&&r.apply(this,arguments)||this;return e.hooks={},e}return e.__extends(i,r),Object.defineProperty(i.prototype,"name",{get:function(){return"isApiAvailable"},enumerable:!1,configurable:!0}),i.prototype.install=function(){return function(e){return m(e)}},i}(i.LiffModule);exports.IsApiAvailableModule=h,exports.isApiAvailable=m,exports.validators=v;
